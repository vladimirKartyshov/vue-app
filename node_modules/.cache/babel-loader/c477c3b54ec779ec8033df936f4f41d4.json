{"ast":null,"code":"import Vue from 'vue';\nimport Vuex from 'vuex';\nimport axios from 'axios';\nimport { API_BASE_URL } from '../config';\nVue.use(Vuex);\nexport default new Vuex.Store({\n  state: {\n    cartProducts: [],\n    cartProductsData: [],\n    userAccessKey: null\n  },\n  mutations: {\n    addProductToCart(state, {\n      productId,\n      amount\n    }) {\n      const item = state.cartProducts.find(item => item.productId === productId);\n\n      if (item) {\n        item.amount += amount;\n      } else {\n        state.cartProducts.push({\n          productId,\n          amount\n        });\n      }\n    },\n\n    updateCartProductAmount(state, {\n      productId,\n      amount\n    }) {\n      const item = state.cartProducts.find(item => item.productId === productId);\n\n      if (item) {\n        item.amount = amount;\n      }\n    },\n\n    deletCartProduct(state, productId) {\n      state.cartProducts = state.cartProducts.filter(item => item.productId !== productId);\n    },\n\n    updateUserAccessKey(state, accessKey) {\n      state.userAccessKey = accessKey;\n    },\n\n    updateCartProductsData(state, itmes) {\n      state.cartProductsData = itmes;\n    },\n\n    syncCartProducts(state) {\n      state.cartProducts = state.cartProductsData.map(item => {\n        return {\n          productId: item.product.id,\n          amount: item.quantity\n        };\n      });\n    }\n\n  },\n  getters: {\n    cartDetailProducts(state) {\n      return state.cartProducts.map(item => {\n        const product = state.cartProductsData.find(p => p.product.id === item.productId).product;\n        return { ...item,\n          product: { ...product,\n            image: product.image.file.url\n          }\n        };\n      });\n    },\n\n    cartTotalPrice(state, getters) {\n      return getters.cartDetailProducts.reduce((acc, item) => item.product.price * item.amount + acc, 0);\n    }\n\n  },\n  actions: {\n    loadCart(context) {\n      setTimeout(() => {\n        axios.get(API_BASE_URL + '/baskets', {\n          params: {\n            userAccessKey: context.state.userAccessKey\n          }\n        }).then(response => {\n          if (!context.state.userAccessKey) {\n            localStorage.setItem('userAccessKey', response.data.user.accessKey);\n            context.commit('updateUserAccessKey', response.data.user.accessKey);\n          }\n\n          context.commit('updateCartProductsData', response.data.items);\n          context.commit('syncCartProducts');\n        }, 1000);\n      });\n    }\n\n  }\n});","map":{"version":3,"names":["Vue","Vuex","axios","API_BASE_URL","use","Store","state","cartProducts","cartProductsData","userAccessKey","mutations","addProductToCart","productId","amount","item","find","push","updateCartProductAmount","deletCartProduct","filter","updateUserAccessKey","accessKey","updateCartProductsData","itmes","syncCartProducts","map","product","id","quantity","getters","cartDetailProducts","p","image","file","url","cartTotalPrice","reduce","acc","price","actions","loadCart","context","setTimeout","get","params","then","response","localStorage","setItem","data","user","commit","items"],"sources":["/home/Kratos/Vs Code/vue-ishop/src/store/index.js"],"sourcesContent":["import Vue from 'vue'\nimport Vuex from 'vuex'\nimport axios from 'axios'\nimport {API_BASE_URL} from '../config'\n\nVue.use(Vuex)\n\nexport default new Vuex.Store({\n  state: {\n    cartProducts: [],\n    cartProductsData: [],\n\n    userAccessKey: null,\n  },\n\n  mutations: {\n    addProductToCart(state, {productId, amount}) {\n      const item = state.cartProducts.find(\n        (item) => item.productId === productId\n      )\n      if (item) {\n        item.amount += amount\n      } else {\n        state.cartProducts.push({\n          productId,\n          amount,\n        })\n      }\n    },\n    updateCartProductAmount(state, {productId, amount}) {\n      const item = state.cartProducts.find(\n        (item) => item.productId === productId\n      )\n      if (item) {\n        item.amount = amount\n      }\n    },\n    deletCartProduct(state, productId) {\n      state.cartProducts = state.cartProducts.filter(\n        (item) => item.productId !== productId\n      )\n    },\n    updateUserAccessKey(state, accessKey) {\n      state.userAccessKey = accessKey\n    },\n    updateCartProductsData(state, itmes) {\n      state.cartProductsData = itmes\n    },\n    syncCartProducts(state) {\n      state.cartProducts = state.cartProductsData.map((item) => {\n        return {\n          productId: item.product.id,\n          amount: item.quantity,\n        }\n      })\n    },\n  },\n\n  getters: {\n    cartDetailProducts(state) {\n      return state.cartProducts.map((item) => {\n        const product = state.cartProductsData.find(\n          (p) => p.product.id === item.productId\n        ).product\n\n        return {\n          ...item,\n          product: {\n            ...product,\n            image: product.image.file.url,\n          },\n        }\n      })\n    },\n    cartTotalPrice(state, getters) {\n      return getters.cartDetailProducts.reduce(\n        (acc, item) => item.product.price * item.amount + acc,\n        0\n      )\n    },\n  },\n\n  actions: {\n    loadCart(context) {\n      setTimeout(() => {\n        axios\n          .get(API_BASE_URL + '/baskets', {\n            params: {\n              userAccessKey: context.state.userAccessKey,\n            },\n          })\n          .then((response) => {\n            if (!context.state.userAccessKey) {\n              localStorage.setItem(\n                'userAccessKey',\n                response.data.user.accessKey\n              )\n              context.commit(\n                'updateUserAccessKey',\n                response.data.user.accessKey\n              )\n            }\n\n            context.commit('updateCartProductsData', response.data.items)\n            context.commit('syncCartProducts')\n          }, 1000)\n      })\n    },\n  },\n})\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}